# Project Context for AI Agents

## ğŸ¯ Purpose

This is a **minimalist NestJS v11 production-ready starter template** designed for building Backend For Frontends (BFFs) or monolithic APIs. It provides a solid, opinionated foundation with modern tooling and best practices, without forcing specific libraries for databases, authentication, or validation.

---

## âš ï¸ CRITICAL RULES FOR AI AGENTS

### Language Rule - MUST FOLLOW

**ALL responses, summaries, explanations, code comments, and communications to the user MUST be in Spanish (EspaÃ±ol).**

This is a Spanish-speaking project. The user communicates in Spanish and expects all responses in Spanish.

- âœ… User messages to AI: Spanish
- âœ… AI responses to user: **Spanish (ALWAYS)**
- âœ… Code comments: Spanish
- âœ… Documentation (README, etc.): Spanish
- âŒ NEVER respond in English to the user
- âš ï¸ Exception: This file (AGENTS.md) is in English for international AI agents to understand context

### Code Style Rules - MUST FOLLOW

**ALL code generated by AI MUST follow these style guidelines:**

#### Variable Naming

1. **Variables MUST be in English**
   - âœ… `const userName = 'John';`
   - âœ… `const isActive = true;`
   - âŒ `const nombreUsuario = 'Juan';`
   - âŒ `const estaActivo = true;`

2. **Variables MUST use camelCase**
   - âœ… `const getUserById = (id: string) => {};`
   - âœ… `const maxLength = 100;`
   - âŒ `const get_user_by_id = (id: string) => {};`
   - âŒ `const max_length = 100;`

3. **Variables MUST be expressive/self-documenting**
   - âœ… `const daysUntilExpiration = 30;`
   - âœ… `const hasActiveSubscription = true;`
   - âŒ `const days = 30;`
   - âŒ `const active = true;`
   - âŒ `const tmp = 'value';`

#### File Naming

4. **File names MUST follow NestJS standard: {name}.{type}.ts**
   - âœ… `users.controller.ts`
   - âœ… `users.service.ts`
   - âœ… `create-user.dto.ts`
   - âœ… `health.module.ts`
   - âŒ `userController.ts`
   - âŒ `user-service.ts`

5. **File names MUST be in English**
   - âœ… `users.controller.ts`
   - âœ… `user-products.service.ts`
   - âŒ `usuarios.controlador.ts`
   - âŒ `productos-usuario.servicio.ts`

6. **File names MUST use lowercase with hyphens (kebab-case) for composite names**
   - âœ… `user-products.service.ts`
   - âœ… `order-items.controller.ts`
   - âœ… `health-check.controller.ts`
   - âŒ `userProducts.service.ts`
   - âŒ `user_products.service.ts`
   - âŒ `UserProducts.service.ts`

7. **File structure MUST match NestJS conventions:**
   - Controllers: `{name}.controller.ts`
   - Services: `{name}.service.ts`
   - DTOs: `{action}-{name}.dto.ts` (e.g., `create-user.dto.ts`, `update-user.dto.ts`)
   - Modules: `{name}.module.ts`
   - Enums: `{name}.enum.ts`
   - Interfaces: `{name}.interface.ts`

#### Code Documentation

8. **NO unnecessary documentation**
   - âŒ Do NOT add JSDoc comments to functions/methods
   - âŒ Do NOT add inline comments explaining obvious code
   - âŒ Do NOT add file headers or descriptions
   - âœ… Only add comments when:
     - Explaining complex logic that isn't immediately clear
     - Documenting business rules or edge cases
     - Adding TODOs or FIXMEs for future work

9. **Comments MUST be in Spanish when absolutely necessary**
   - If a comment is needed (see point 8), it MUST be in Spanish
   - Follows the same language rule as all other communications

10. **NEVER use emojis**
    - âŒ Do NOT use emojis in code comments
    - âŒ Do NOT use emojis in variable names
    - âŒ Do NOT use emojis in any code-related content
    - Keep code professional and clean

#### Examples

**INCORRECT:**

```typescript
// Obtiene el usuario de la base de datos
async getUsuario(idUsuario: string) {
  const usr = await this.db.findOne(idUsuario); // Retorna el usuario encontrado
  return usr;
}
```

**CORRECT:**

```typescript
async getUserById(userId: string) {
  return await this.db.findOne(userId);
}
```

**CORRECT (only if comment is necessary):**

```typescript
async getUserById(userId: string) {
  // El token expira en 5 minutos, por lo que necesitamos refrescarlo primero
  const token = await this.refreshTokenIfNeeded(userId);
  return await this.db.findOne(userId);
}
```

**File Structure Examples:**

```
contexts/
â”œâ”€â”€ users/
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â””â”€â”€ users.controller.ts
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ users.service.ts
â”‚   â”œâ”€â”€ dtos/
â”‚   â”‚   â”œâ”€â”€ create-user.dto.ts
â”‚   â”‚   â”œâ”€â”€ update-user.dto.ts
â”‚   â”‚   â””â”€â”€ user-products.dto.ts
â”‚   â”œâ”€â”€ enums/
â”‚   â”‚   â””â”€â”€ user-status.enum.ts
â”‚   â””â”€â”€ users.module.ts
```

---

### Example Interactions

**CORRECT:**

```
User: "Agrega un endpoint para listar usuarios"
AI: "Voy a crear un endpoint GET /api/users para listar usuarios. Primero crearÃ© el
     controlador, servicio y DTO necesarios..."
```

**INCORRECT:**

```
User: "Agrega un endpoint para listar usuarios"
AI: "I'll create a GET /api/users endpoint to list users..." WRONG - Must be in Spanish
```

---

## ğŸ—ï¸ Project Philosophy

### What This Template Provides (Keep These)

This is a **curated starter** with opinionated tooling for development quality:

1. **Modern NestJS v11 setup** - Latest framework version
2. **Fastify instead of Express** - ~2x better performance
3. **Strict TypeScript 5.7 configuration** - Maximum type safety
4. **Comprehensive linting** - ESLint 9 flat config + Unicorn + Prettier
5. **Docker multi-stage builds** - Optimized dev & production images
6. **Git hooks** - lint-staged, conventional commits, pre-push validation
7. **Testing infrastructure** - Jest configured for unit & e2e
8. **Environment validation** - Joi schema validation
9. **Context-based architecture** - DDD-inspired folder structure
10. **Configurable logger module** - Global logger with levels
11. **Security middleware** - Helmet (HTTP headers) and CORS fully configured
12. **Request Context** - Language and Timezone capture from headers

### What This Template Does NOT Include (By Design)

This is intentionally **minimalist and unopinionated** about business logic libraries.

**DO NOT add these unless explicitly requested by the user:**

- âŒ **Database libraries** (Prisma, TypeORM, MikroORM, etc.)
  - Reason: User chooses based on project needs
- âŒ **Authentication** (Passport, JWT strategy, sessions, etc.)
  - Reason: Auth requirements vary widely per project
- âŒ **Validation libraries** (class-validator, zod, etc.)
  - Reason: User decides validation approach (only Joi for env vars)
- âŒ **Rate limiting** (@nestjs/throttler)
  - Reason: Project-specific requirement
- âŒ **API documentation** (Swagger/OpenAPI)
  - Reason: Optional feature, not always needed
- âŒ **Caching** (Redis, cache-manager)
  - Reason: Project-specific architecture decision

**When user asks for these:** Suggest options, ask for preference, then help implement.

---

## ğŸ“‚ Project Structure

```
src/
â”œâ”€â”€ config/                    # Global configuration
â”‚   â”œâ”€â”€ app-config.service.ts     # Typed ConfigService wrapper
â”‚   â”œâ”€â”€ config.module.ts          # Global config module
â”‚   â””â”€â”€ env/                      # Environment variables
â”‚       â”œâ”€â”€ env.types.ts          # TypeScript interface for env vars
â”‚       â”œâ”€â”€ env.schema.ts         # Joi runtime validation schema
â”‚       â””â”€â”€ environment.enum.ts   # Environment enum
â”œâ”€â”€ contexts/                  # Business contexts (DDD-inspired)
â”‚   â”œâ”€â”€ health/               # Example context: Health check
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ dtos/
â”‚   â”‚   â”œâ”€â”€ enums/
â”‚   â”‚   â””â”€â”€ health.module.ts
â”‚   â””â”€â”€ shared/               # Shared modules across contexts
â”‚       â”œâ”€â”€ logger/           # Global logger module
â”‚       â”œâ”€â”€ decorators/       # Custom decorators (Language, Timezone)
â”‚       â”œâ”€â”€ interceptors/     # Global interceptors (Request Context)
â”‚       â”œâ”€â”€ utils/            # Shared utilities
â”‚       â”œâ”€â”€ types/            # Shared types
â”‚       â””â”€â”€ enums/            # Shared enums (Language, etc.)
â”œâ”€â”€ app.module.ts             # Root application module
â””â”€â”€ main.ts                   # Application entry point (Fastify setup)
```

### Configuration System

The template uses a **typed ConfigService wrapper** for type-safe environment variable access:

- `env/env.types.ts` - TypeScript interface defining all env variables with their exact types
- `env/env.schema.ts` - Joi schema for runtime validation (validates on app startup)
- `app-config.service.ts` - Typed service that wraps @nestjs/config with getters for each variable
- `config.module.ts` - Global module that exports the typed ConfigService

**Key benefits:**

- âœ… Autocomplete in IDE for all environment variables
- âœ… Type safety (not just annotations - real TypeScript types)
- âœ… Centralized default values
- âœ… Prevention of typos in variable names
- âœ… Easier refactoring (rename propagates everywhere)

**Important for AI Agents:**
When suggesting new environment variables, you MUST update ALL FOUR files:

1. Add type to `env/env.types.ts`
2. Add Joi validation to `env/env.schema.ts`
3. Add getter to `app-config.service.ts`
4. Update `.env.example`

**Example for adding a new variable:**

```typescript
// 1. env/env.types.ts
export interface EnvironmentVariables {
  // ... existing variables
  DATABASE_URL: string;
}

// 2. env/env.schema.ts
export const envValidationSchema = Joi.object<EnvironmentVariables>({
  // ... existing validations
  DATABASE_URL: Joi.string().uri().required(),
});

// 3. app-config.service.ts
get databaseUrl(): string {
  return this.nestConfigService.get('DATABASE_URL', { infer: true })!;
}

// 4. .env.example
DATABASE_URL=postgresql://localhost:5432/db
```

**Always use the typed AppConfigService:**

```typescript
// âœ… Correct (typed)
constructor(private configService: AppConfigService) {}
const port = this.configService.port;

// âŒ Wrong (untyped)
constructor(private configService: ConfigService) {} // from @nestjs/config
const port = this.configService.get('PORT');
```

### Context-Based Architecture Explanation

Instead of traditional `controllers/`, `services/`, `dtos/` folders, this template uses **contexts**:

- **Philosophy:** Each business domain gets its own self-contained context
- **Benefits:**
  - Better organization for growing codebases
  - Clear boundaries between domains
  - Easier to reason about feature locations
  - Scales better than flat folder structure
- **When to create a new context:**
  - New business domain (e.g., `users`, `products`, `orders`)
  - Distinct feature area with multiple files
  - NOT for every single endpoint (keep it reasonable)

**Shared vs Context:**

- `contexts/[name]/`: Domain-specific code
- `contexts/shared/`: Code used across multiple contexts
- `config/`: Global app configuration

### Testing Architecture Explanation

This template uses a **separated testing structure** where tests live outside the `src/` directory, maintaining a mirror structure:

- **Philosophy:** Separation of concerns - production code is clean, tests are organized in a dedicated folder
- **Benefits:**
  - Production code is cleaner (no test files mixed in)
  - Easier to understand project structure at a glance
  - Better for large-scale projects
  - Enterprise-standard approach
- **Structure:**
  - `test/unit/`: Unit tests (mirrors `src/` structure)
  - `test/e2e/`: E2E tests (mirrors `src/` structure)

**Example Structure:**

```
test/
â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ app-config.service.spec.ts
â”‚   â””â”€â”€ contexts/
â”‚       â””â”€â”€ health/
â”‚           â””â”€â”€ controllers/
â”‚               â””â”€â”€ health.controller.spec.ts
â””â”€â”€ e2e/
    â””â”€â”€ contexts/
        â””â”€â”€ health/
            â””â”€â”€ health.e2e-spec.ts
```

**Import Pattern in Tests:**

ALL tests MUST use **absolute imports with `src/` alias**:

```typescript
// âœ… Correct (absolute import)
import { AppConfigService } from 'src/config/app-config.service';
import { HealthController } from 'src/contexts/health/controllers/health.controller';

// âŒ Wrong (relative import)
import { AppConfigService } from '../../../src/config/app-config.service';
```

**Why absolute imports?**

- Consistent across all test files
- Easier to refactor
- IDE autocomplete works better
- Less error-prone when moving files

**How it works:**

1. **tsconfig.json** - Configures paths:

```json
{
  "compilerOptions": {
    "baseUrl": "./",
    "paths": {
      "src/*": ["./src/*"]
    }
  }
}
```

2. **package.json** - Configures Jest (unit tests):

```json
{
  "jest": {
    "moduleNameMapper": {
      "^src/(.*)$": "<rootDir>/src/$1"
    }
  }
}
```

3. **test/jest-e2e.json** - Configures Jest e2e:

```json
{
  "moduleNameMapper": {
    "^src/(.*)$": "<rootDir>/../src/$1"
  }
}
```

**Important for AI Agents:**

- When creating new tests, ALWAYS use absolute imports with `src/` prefix
- Follow the mirror structure: if code is in `src/config/`, test goes in `test/unit/config/`
- Update Jest configuration if adding new test locations
- Test files must use `.spec.ts` (unit) or `.e2e-spec.ts` (e2e) suffix

---

## ğŸ› ï¸ Technology Stack

| Category         | Technology | Version                               |
| ---------------- | ---------- | ------------------------------------- |
| Runtime          | Node.js    | 24.x                                  |
| Framework        | NestJS     | 11.x                                  |
| HTTP Server      | Fastify    | Latest (via @nestjs/platform-fastify) |
| Language         | TypeScript | 5.7.x (strict mode)                   |
| Testing          | Jest       | 29.x                                  |
| Linting          | ESLint     | 9.x (flat config)                     |
| Formatting       | Prettier   | 3.x                                   |
| Env Validation   | Joi        | 18.x                                  |
| Git Hooks        | Husky      | 10.x                                  |
| Containerization | Docker     | Multi-stage builds                    |

### Key Configuration Details

**TypeScript (tsconfig.json):**

- `strict: true` - All strict checks enabled
- `noUnusedLocals: true` - Enforce no unused variables
- `noImplicitReturns: true` - All code paths must return
- `target: ES2022` - Modern JavaScript features

**ESLint (eslint.config.mjs):**

- New flat config format (ESLint 9+)
- TypeScript ESLint with type-checking
- Unicorn plugin for Node.js best practices
- Simple Import Sort for consistent imports
- Prettier integration for formatting

**Docker:**

- Base: `node:24-alpine` (minimal image)
- Multi-stage: dev (hot-reload) + production (optimized)
- BuildKit cache mounts for faster builds
- Non-root user in production

---

## ğŸ”„ Development Workflow

### Typical User Journey

1. Clone/use this template
2. Run `npm install`
3. Copy `.env.example` to `.env`
4. Start development:
   - Local: `npm run start:dev`
   - Docker: `docker-compose up my-service-dev`
5. Add features specific to their project
6. Build with confidence (strict TS + comprehensive linting)

### Git Workflow (Enforced by Hooks)

1. **Make changes** to code
2. **Stage files** (`git add`)
3. **Commit** with conventional format
   - Hook runs: lint-staged (ESLint + Prettier on staged files)
   - Hook validates: commit message format
   - Fails if: linting errors or invalid commit message
4. **Push** to remote
   - Hook runs: `npm run build` and `npm test`
   - Fails if: build errors or test failures

---

## ğŸ’¡ Common User Requests - How to Handle

### "Add database support"

âŒ **Don't:** Install Prisma/TypeORM without asking
âœ… **Do:**

1. Respond in Spanish: "Para agregar soporte de base de datos, Â¿quÃ© ORM prefieres usar?"
2. Suggest options: Prisma, TypeORM, MikroORM
3. Ask about database: PostgreSQL, MySQL, MongoDB, etc.
4. Once decided, help configure with best practices

### "Add authentication"

âŒ **Don't:** Install Passport or implement JWT without clarity
âœ… **Do:**

1. Respond in Spanish: "Â¿QuÃ© estrategia de autenticaciÃ³n necesitas?"
2. Ask: JWT? OAuth? Sessions? API Keys?
3. Once decided, help implement properly
4. Suggest where in architecture to add (probably new `contexts/auth/`)

### "Add validation to DTOs"

âŒ **Don't:** Install class-validator automatically
âœ… **Do:**

1. Respond in Spanish: "Â¿Prefieres usar class-validator con decoradores o Zod?"
2. Explain trade-offs of each
3. Once decided, help configure ValidationPipe and create examples

### "Make it faster / More secure / Better code quality"

âœ… **Do:** Analyze and suggest improvements
âœ… **Keep minimalist philosophy** - don't add unnecessary dependencies
âœ… **Explain trade-offs** in Spanish

### "Add Swagger documentation"

âŒ **Don't:** Add automatically (it's opinionated)
âœ… **Do:**

1. Confirm: "Â¿Quieres agregar documentaciÃ³n automÃ¡tica con Swagger/OpenAPI?"
2. If yes, install `@nestjs/swagger` and configure
3. Show how to decorate DTOs and controllers

### "Need internationalization / multi-language support"

âœ… **Do:** Suggest using the built-in Request Context feature
âœ… **Explain:**

1. Template already includes `@GetLanguage()` decorator
2. Captures `Accept-Language` header automatically
3. Returns `'en'` or `'es'` (type-safe with Language enum)
4. Example use case: Return localized messages based on language

### "Need timezone-aware date formatting"

âœ… **Do:** Suggest using the built-in Request Context feature
âœ… **Explain:**

1. Template already includes `@GetTimeZone()` decorator
2. Captures `Time-Zone` header automatically
3. Validates IANA timezone (e.g., 'America/Lima', 'UTC')
4. Example use case: Format dates according to user's timezone

---

## ğŸš« What NOT to Do

1. **Never respond in English** to the user (except in this AGENTS.md file)
2. **Don't add runtime dependencies** without asking user first
3. **Don't remove** existing linting/tooling (it's template's value)
4. **Don't suggest** removing Docker, strict TypeScript, or git hooks
5. **Don't break** the context-based architecture without good reason
6. **Don't ignore** the minimalist philosophy (keep it lean)
7. **Don't add unnecessary comments or documentation** - Keep code clean and self-documenting
8. **Don't use non-English variable names** - All variables must be in English
9. **Don't use non-standard naming conventions** - Follow camelCase for vars, kebab-case for files

---

## âœ… What You Should Do Proactively

1. **Always communicate in Spanish** with the user
2. **Maintain strict TypeScript** - don't suggest loosening types
3. **Follow conventional commits** in any examples
4. **Suggest testing** for new features
5. **Keep context organization** when adding features
6. **Respect git hooks** - they ensure quality
7. **Ask before adding** new dependencies
8. **Explain trade-offs** when suggesting changes
9. **Keep code minimal** - No unnecessary comments, no emojis, clean and professional
10. **Use expressive variable names** - Variables should be self-documenting
11. **Follow NestJS naming conventions** - File names: {name}.{type}.ts in English
12. **Use env-var-manager skill** when adding features requiring environment variables - Consult `skills/env-var-manager/` for standardized workflow of adding env vars with proper types, validation, and documentation

---

## ğŸ“ Example Interaction

**User:** "Necesito agregar un mÃ³dulo de usuarios con CRUD completo"

**Good AI Response (in Spanish):**

```
Perfecto, voy a crear un mÃ³dulo de usuarios con operaciones CRUD. Primero necesito saber:

1. Â¿QuÃ© base de datos vas a usar? (para crear el modelo)
2. Â¿Necesitas autenticaciÃ³n en estos endpoints o son pÃºblicos?
3. Â¿QuÃ© validaciones necesitas en los DTOs?

Mientras tanto, voy a crear la estructura base del contexto `users`:
- contexts/users/controllers/users.controller.ts
- contexts/users/services/users.service.ts
- contexts/users/dtos/create-user.dto.ts
- contexts/users/dtos/update-user.dto.ts
- contexts/users/users.module.ts

Â¿Quieres que proceda con esta estructura?
```

**Bad AI Response:**

```
I'll create a users module with Prisma and JWT authentication... âŒ
(Wrong: English + assumptions about DB and auth)
```

---

## ğŸ“ Summary for AI Agents

- **Language:** ALWAYS Spanish for user communication
- **Philosophy:** Minimalist, unopinionated about business libraries
- **Keep:** Linting, typing, Docker, git hooks, architecture
- **Don't add:** DB, auth, validation libs without asking
- **When asked:** Suggest options, explain trade-offs, then implement
- **Code quality:** Maintain strict TS, comprehensive linting
- **Architecture:** Context-based, DDD-inspired
- **Testing:** Encourage and help implement
- **Code style:** Minimal comments, no emojis, Spanish only when necessary
- **Variable naming:** English only, camelCase, expressive/self-documenting
- **File naming:** English only, {name}.{type}.ts, lowercase with hyphens for composites

Remember: This is a **starting point**, not a complete framework. Users build their specific applications on top of this solid foundation.

---

## ğŸ”— Useful References

- NestJS Docs: https://docs.nestjs.com
- Fastify Docs: https://fastify.dev
- TypeScript Handbook: https://www.typescriptlang.org/docs
- ESLint Flat Config: https://eslint.org/docs/latest/use/configure/configuration-files-new
- Conventional Commits: https://www.conventionalcommits.org

---

**Last Updated:** 2026-02-08  
**Template Version:** 2.0.0  
**NestJS Version:** 11.x  
**Node Version:** 24.x
